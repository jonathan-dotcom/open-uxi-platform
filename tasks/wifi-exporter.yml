---
- name: Install Wi-Fi exporter dependencies (Debian)
  ansible.builtin.apt:
    name:
      - iw
      - python3
      - python3-prometheus-client
    state: present
  when:
    - ansible_facts.os_family == "Debian"
    - wifi_exporter_enable | default(false)

- name: Ensure Wi-Fi exporter script is deployed
  ansible.builtin.template:
    src: templates/wifi_exporter.py.j2
    dest: /usr/local/bin/wifi_exporter.py
    mode: "0755"
  notify: Restart wifi exporter
  when: wifi_exporter_enable | default(false)

- name: Deploy Wi-Fi exporter systemd unit
  ansible.builtin.template:
    src: templates/wifi_exporter.service.j2
    dest: /etc/systemd/system/wifi_exporter.service
    mode: "0644"
  notify: Restart wifi exporter
  when: wifi_exporter_enable | default(false)

- name: Ensure Wi-Fi exporter service is enabled and running
  ansible.builtin.systemd:
    name: wifi_exporter
    enabled: true
    state: started
  when: wifi_exporter_enable | default(false)
